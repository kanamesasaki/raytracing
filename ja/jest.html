<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CCZTCJYRD8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CCZTCJYRD8');
    </script>
    <meta charset="UTF-8">
    <title>ES6モジュールをBabelなしでJestテストする方法 - WebGL2でレイトレーシング</title>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <link rel="stylesheet" href="../style.css">
  </head>
  <header>
    <a href="index.html">WebGL2でレイトレーシング</a> &#187;
    <a href="jest.html">ES6モジュールをBabelなしでJestテストする方法</a>
    <span style="float: right"><ul class="select-lang">
        <li><a href="../en/index.html">English</a></li>
        <li><a href="../de/index.html">Deutsch</a></li>
        <li><a href="../ja/index.html">日本語</a></li>
    </ul></span>
  </header>

  <body>
    <h1>ES6モジュールをBabelなしでJestテストする方法</h1>
    <h2>npmプロジェクトの作成</h2>
    <p>プロジェクトを作成したいディレクトリ(ここではC:\projects\raytracing)で以下のコマンドを打つ．</p>
<pre><code>C:\projects\raytracing>npm init</code></pre>
    <p>以下のようにいくつか質問に答えていくと，自動的にpackage.jsonファイルが作成される．</p>
<pre><code>package name: (raytracing)
version: (1.0.0)
description:
entry point: (index.js)
test command:
git repository:
keywords:
author: Kaname Sasaki
license: (ISC) MIT
About to write to C:\projects\raytracing\package.json:

{
  "name": "raytracing",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "Kaname Sasaki",
  "license": "MIT"
}

Is this OK? (yes)
</code></pre>

    <h2>Jestの設定</h2>
    <p>以下のコマンドでJestをインストールする．</p>
<pre><code>C:\projects\raytracing>npm install --save-dev jest</code></pre>
    <p>package.jsonに以下のように"scripts"と"type"の設定を追加する．</p>
<pre><code>{
  "name": "raytracing",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "directories": {
    "test": "test"
  },
  "scripts": {
    "test": "node --experimental-vm-modules node_modules/jest/bin/jest.js"
  },
  "type": "module",
  "author": "",
  "license": "MIT",
  "devDependencies": {
    "jest": "^26.6.3"
  }
}</code></pre>
<p>jest.config.jsを作成して，以下のように記述する．</p>
<pre><code>export default {
  testEnvironment: 'jest-environment-node',
  transform: {}
};</code></pre>
<p>以下のコマンドでJestテストが実行できる．</p>
<pre><code>C:\projects\raytracing>npm test</code></pre>

<h2>ローカルサーバーの作成</h2>
<p>
  作成したJavaScriptをブラウザ上で実行する場合，HTML内でひとつずつJavaScriptファイルを読み込む方法と，JavaScriptのimport/exportを用いて呼び出す方法の2通りが考えられる．
  import/exportはローカルファイル上では機能しないので，ローカルサーバーが必要になる．
  Node.jsを用いれば，実行したいHTMLファイルのあるディレクトリで以下のコマンドを打つと，簡単にローカルサーバーが建てられる．
</p>
<pre><code>C:\projects\raytracing>npx http-server</code></pre>

  </body>
  <footer>
    <a href="index.html">WebGL2でレイトレーシング</a> &#187;
    <a href="jest.html">ES6モジュールをBabelなしでJestテストする方法</a>
    <span style="float: right">Copyright 2021, Kaname Sasaki</span>
  </footer>
</html>