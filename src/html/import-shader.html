<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CCZTCJYRD8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CCZTCJYRD8');
    </script>
    <meta charset="UTF-8">
    <title>How to import GLSL shader scripts from JavaScript - Ray Tracing in WebGL2</title>
    <script type="text/javascript" id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
    <link rel="stylesheet" href="../style.css">
  </head>
  <header>
    <a href="index.html">Ray Tracing in WebGL2</a> &#187;
    <a href="import-shader.html">How to import GLSL shader scripts from JavaScript</a>
    <span style="float: right"><ul class="select-lang">
        <li><a href="../en/index.html">English</a></li>
        <li><a href="../de/index.html">Deutsch</a></li>
        <li><a href="../ja/index.html">日本語</a></li>
    </ul></span>
  </header>

  <body>
    <h1>How to import GLSL shader scripts from JavaScript</h1>
    <p>
      If you want to use WebGL on the web browser, you can write GLSL code directly in the HTML file as a script.
      However, with this method, it is difficult to edit and maintain the GLSL code. 
      Therefore, it would be better to write the GLSL code in a separate file and import from the other file.
      One simple idea would be to write the following HTML code, but unfortunately this does not work. 
    </p>
    <pre><code>&lt;script src="shader.glsl" id="vertex-shader" type="x-shader/x-vertex">&lt;/script></code></pre>
    <p>
      In principle, it is not necessary to import GLSL code in the HTML file, because GLSL code is required in JavaScript at the end.
      Therefore, importing GLSL code directly to the JavaScript is actually more simple.
      You can create a JavaScript file (vertex-shader.glsl.js) containing the shader code as a text by the following way.
    </p>
<pre><code>export default `#version 300 es
precision mediump float;

uniform mat4 uModelViewMatrix;
uniform mat4 uProjectionMatrix;
uniform mat4 uNormalMatrix;
uniform vec3 uLightDirection;
uniform vec3 uLightDiffuse;
uniform vec3 uMaterialDiffuse;

in vec3 aVertexPosition;
in vec3 aVertexNormal;

out vec4 vVertexColor;

void main(void) {
    // Calculate the normal vector
    vec3 N = normalize(vec3(uNormalMatrix * vec4(aVertexNormal, 1.0)));

    // Normalized light direction
    vec3 L = normalize(uLightDirection);

    // Dot product of the normal product and negative light direction vector
    float lambertTerm = dot(N, -L);

    // Calculating the diffuse color based on the Lambertian reflection model
    vec3 Id = uMaterialDiffuse * uLightDiffuse * lambertTerm;

    // Set the varying to be used inside of the fragment shader
    vVertexColor = vec4(Id, 1.0);

    // Setting the vertex position
    gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aVertexPosition, 1.0);
}`
</code></pre>
    <p>
      The exported shader code can be imported from other JavaScript files as shown below.
      In this case, vertexSource contains the GLSL code as a text.
    </p>
<pre><code>import vertexSource from './vertex-shader.glsl.js'

shader = gl.createShader(gl.VERTEX_SHADER)
gl.shaderSource(shader, shaderString)
</code></pre>
    <p>
      Regading this method, please see also the following page:<br>
      <a href="https://stackoverflow.com/questions/14219947/why-do-shaders-have-to-be-in-html-file-for-webgl-program">https://stackoverflow.com/questions/14219947/why-do-shaders-have-to-be-in-html-file-for-webgl-program</a>
    </p>
    
  </body>
  <footer>
    <a href="index.html">Ray Tracing in WebGL2</a> &#187;
    <a href="import-shader.html">How to import GLSL shader scripts from JavaScript</a>
    <span style="float: right">Copyright 2021, Kaname Sasaki</span>
  </footer>
</html>